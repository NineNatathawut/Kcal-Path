<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Foodie Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#FFFFFF; --muted:#333333; --soft:#F5F5F5; --accent:#A7C491;
  --cal-color:#6FB3B8; --pro-color:#A7C491; --fat-color:#EFC75E; --carb-color:#EF954C;
  --card-shadow:0 8px 20px rgba(0,0,0,0.06); --radius:12px;
}
*{box-sizing:border-box;}
html,body{height:100%; margin:0; font-family:'Sarabun',sans-serif; background:var(--soft); color:var(--muted); display:flex; flex-direction:column; align-items:center; padding:20px;}
header{position:fixed; top:16px; right:20px; display:flex; gap:12px; align-items:center;}
.search-box{position:relative; width:clamp(280px, 30vw, 360px);} /* ปรับขนาดช่องค้นหา */
.search-box input{width:100%; padding:12px 40px 12px 12px; border-radius:12px; border:1px solid #e6e6e6; box-shadow:0 6px 18px rgba(0,0,0,0.05); font-size:18px;}
.search-box .icon{position:absolute; right:12px; top:50%; transform:translateY(-50%); width:20px; height:20px; opacity:0.6; pointer-events:none;}
ul#suggestions{display:none; position:absolute; top:calc(100% + 8px); left:0; right:0; background:var(--bg); border-radius:10px; box-shadow:var(--card-shadow); list-style:none; max-height:200px; overflow:auto; padding:6px; z-index: 100;}
ul#suggestions li{padding:8px; border-radius:8px; cursor:pointer; font-size:16px;}
ul#suggestions li:hover{background:#f2f2f2;}
.match{font-weight:700; color:var(--cal-color);}
main{margin-top:80px; display:flex; flex-direction:column; align-items:center; gap:24px; width:100%; max-width:1000px;}
.summary{width:100%; max-width:820px; background:var(--bg); border-radius:var(--radius); padding:28px; box-shadow:var(--card-shadow); display:flex; flex-direction:column; align-items:center; gap:20px;}
.cal-circle{position:relative; width:clamp(200px, 40vw, 280px); height:clamp(200px, 40vw, 280px);} /* ปรับขนาดวงกลมพลังงาน */
.cal-circle svg{transform:rotate(-90deg); width:100%; height:100%;}
.cal-circle circle{fill:none; stroke-linecap:round;}
.cal-circle .bg{stroke:#eeeeee; stroke-width:12;}
.cal-circle .prog{stroke:var(--cal-color); stroke-width:12; transition: stroke-dashoffset 700ms;}
.cal-center{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; pointer-events:none;}
.cal-center .num{font-size:clamp(20px, 4vw, 28px); font-weight:700;}
.cal-center .label{font-size:clamp(14px, 3vw, 16px); color:#666; margin-top:6px;}
.small-row{display:flex; gap:clamp(12px, 2vw, 24px); justify-content:center; margin-top:12px; flex-wrap:wrap;}
.small-circle{position:relative; width:clamp(90px, 20vw, 120px); height:clamp(90px, 20vw, 120px); background:var(--bg); border-radius:12px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; padding:10px; box-shadow:0 6px 14px rgba(0,0,0,0.04);} /* ปรับขนาดวงกลมรอง */
.small-circle svg{transform:rotate(-90deg); width:70%; height:70%;}
.small-circle circle{fill:none; stroke-linecap:round;}
.small-circle .bg{stroke:#eee; stroke-width:8;}
.small-circle .prog{stroke-width:8; transition: stroke-dashoffset 700ms;}
.small-label{font-size:clamp(12px, 2vw, 14px); color:#666;}
.small-value{font-weight:700; color:#222; font-size:clamp(14px, 3vw, 16px);}
.bmi-box, .menu-detail-box{width:100%; max-width:820px; background:var(--bg); border-radius:var(--radius); padding:20px; box-shadow:var(--card-shadow); display:flex; flex-direction:column; gap:12px;}
.bmi-box h3, .menu-detail-box h3{margin:0; font-size:20px; font-weight:600;}
.bmi-box input, .bmi-box select{padding:8px 12px; border-radius:8px; border:1px solid #ddd; font-size:16px; width:100%;}
.bmi-box button, .menu-detail-box button{margin-top:10px; padding:10px 16px; font-weight:700; border:none; border-radius:10px; cursor:pointer; background:var(--accent); color:#fff;}
.result-box{margin-top:12px; text-align:center; font-weight:700;}
.result-box span{font-size:18px; display:block; margin-top:4px;}
.nutrition-item {font-size: 16px; color: #555;}
.nutrition-item span {font-weight: 600; color: var(--muted);}
footer{margin-top:20px; text-align:center; font-size:14px; color:#888;}
</style>
</head>
<body>

<header>
  <div class="search-box">
    <input id="top-search" type="text" placeholder="ค้นหาอาหาร..." autocomplete="off" />
    <svg class="icon" viewBox="0 0 24 24">
      <path fill="#666" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.49 21.49 20 15.5 14zM4 9.5A5.5 5.5 0 119.5 15 5.5 5.5 0 014 9.5z"/>
    </svg>
    <ul id="suggestions"></ul>
  </div>
</header>

<main>
  <div class="stage">
    <section class="summary">
      <div class="cal-circle">
        <svg viewBox="0 0 180 180" preserveAspectRatio="xMidYMid meet">
          <circle class="bg" cx="90" cy="90" r="72" stroke-width="12"></circle>
          <circle id="calProg" class="prog" cx="90" cy="90" r="72" stroke-width="12"></circle>
        </svg>
        <div class="cal-center">
          <div class="num" id="calNum">0 kcal</div>
          <div class="label">พลังงาน</div>
        </div>
      </div>
      <div class="small-row">
        <div class="small-circle">
          <svg viewBox="0 0 100 100"><circle class="bg" cx="50" cy="50" r="40"></circle><circle id="proProg" class="prog" cx="50" cy="50" r="40" stroke="#A7C491"></circle></svg>
          <div class="small-value" id="proNum">0 g</div>
          <div class="small-label">โปรตีน</div>
        </div>
        <div class="small-circle">
          <svg viewBox="0 0 100 100"><circle class="bg" cx="50" cy="50" r="40"></circle><circle id="fatProg" class="prog" cx="50" cy="50" r="40" stroke="#EFC75E"></circle></svg>
          <div class="small-value" id="fatNum">0 g</div>
          <div class="small-label">ไขมัน</div>
        </div>
        <div class="small-circle">
          <svg viewBox="0 0 100 100"><circle class="bg" cx="50" cy="50" r="40"></circle><circle id="carbProg" class="prog" cx="50" cy="50" r="40" stroke="#EF954C"></circle></svg>
          <div class="small-value" id="carbNum">0 g</div>
          <div class="small-label">คาร์โบไฮเดรต</div>
        </div>
      </div>
      <button id="resetDay" style="margin-top:12px; padding:10px 16px; border:none; border-radius:10px; background:#ef954c; color:#fff; font-weight:700; cursor:pointer;">วันต่อไป (รีเซ็ต)</button>
    </section>

    <section class="menu-detail-box" id="menuDetail" style="display: none;">
      <div style="display: flex; gap: 20px; align-items: center;">
        <img id="menuImage" src="" alt="Menu Image" style="width: 100px; height: 100px; border-radius: 12px; object-fit: cover;">
        <div style="flex: 1;">
          <h3 id="menuName" style="margin: 0 0 10px 0; font-size: 24px; font-weight: 600;"></h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <div class="nutrition-item">พลังงาน: <span id="calDetail"></span> kcal</div>
            <div class="nutrition-item">โปรตีน: <span id="proDetail"></span> g</div>
            <div class="nutrition-item">ไขมัน: <span id="fatDetail"></span> g</div>
            <div class="nutrition-item">คาร์โบไฮเดรต: <span id="carbDetail"></span> g</div>
          </div>
        </div>
      </div>
      <button id="addMenuBtn" style="margin-top: 20px; padding: 10px 16px; font-weight: 700; border: none; border-radius: 10px; cursor: pointer; background: var(--accent); color: #fff;">บันทึกเมนู</button>
    </section>

    <section class="bmi-box">
      <h3 style="margin-bottom: 20px;">คำนวณ BMR & BMI</h3>
      <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
        <div>เพศ<select id="gender"><option value="male">ชาย</option><option value="female">หญิง</option></select></div>
        <div>อายุ (ปี)<input type="number" id="age" placeholder="อายุ"></div>
        <div>ส่วนสูง (cm)<input type="number" id="height" placeholder="ส่วนสูง"></div>
        <div>น้ำหนัก (kg)<input type="number" id="weight" placeholder="น้ำหนัก"></div>
        <div>ระดับกิจกรรม<select id="activity"><option value="1.2">ไม่ออกกำลังกาย</option><option value="1.375">เบา</option><option value="1.55">ปานกลาง</option><option value="1.725">หนัก</option></select></div>
        <div>เป้าหมาย<select id="goal"><option value="maintain">คงที่</option><option value="lose">ลดน้ำหนัก</option><option value="gain">เพิ่มน้ำหนัก</option></select></div>
      </div>
      <button id="calcBtn" style="margin-top:20px; background:var(--accent);">คำนวณ BMR & BMI</button>
      <div class="result-box" id="bmrResult" style="margin-top: 20px; text-align: left; font-size: 16px; font-weight: 400;"></div>
      <div class="result-box" id="bmiResult" style="text-align: left; font-size: 16px; font-weight: 400;"></div>
    </section>
  </div>
</main>

<footer>© 2025 Foodie Tracker</footer>

<script>
// Menu data
const menuData = [
  { name:'ผัดกะเพราไก่', imageURL:'https://images.unsplash.com/photo-1636640438799-6f1a0da8228a?q=80&w=800&auto=format&fit=crop', nutrition:{calories:450, protein:35, fat:20, carbs:30} },
  { name:'ต้มยำกุ้ง', imageURL:'https://images.unsplash.com/photo-1626073079715-ef71e30c1a02?q=80&w=800&auto=format&fit=crop', nutrition:{calories:220, protein:15, fat:10, carbs:16} },
  { name:'ส้มตำไทย', imageURL:'https://images.unsplash.com/photo-1626072845734-b5036e2de4e3?q=80&w=800&auto=format&fit=crop', nutrition:{calories:140, protein:5, fat:4, carbs:18} },
  { name:'ข้าวมันไก่', imageURL:'https://images.unsplash.com/photo-1626073102467-1a5d1b2c718e?q=80&w=800&auto=format&fit=crop', nutrition:{calories:520, protein:30, fat:16, carbs:58} },
  { name:'ไก่ทอดน้ำปลา', imageURL:'https://images.unsplash.com/photo-1604908177571-271bbf2df4a3?q=80&w=800&auto=format&fit=crop', nutrition:{calories:560, protein:40, fat:28, carbs:36} }
];

let totals = { calories:0, protein:0, fat:0, carbs:0 };
const GOALS = { calories:2000, protein:75, fat:70, carbs:300 };

// Elements
const searchInput = document.getElementById('top-search');
const suggestions = document.getElementById('suggestions');
const calProg = document.getElementById('calProg');
const proProg = document.getElementById('proProg');
const fatProg = document.getElementById('fatProg');
const carbProg = document.getElementById('carbProg');
const calNum = document.getElementById('calNum');
const proNum = document.getElementById('proNum');
const fatNum = document.getElementById('fatNum');
const carbNum = document.getElementById('carbNum');
const resetBtn = document.getElementById('resetDay');

const bmiResult = document.getElementById('bmiResult');
const bmrResult = document.getElementById('bmrResult');
const weightInput = document.getElementById('weight');
const heightInput = document.getElementById('height');
const ageInput = document.getElementById('age');
const genderInput = document.getElementById('gender');
const activityInput = document.getElementById('activity');
const goalInput = document.getElementById('goal');
const calcBtn = document.getElementById('calcBtn');

const menuDetailBox = document.getElementById('menuDetail');
const menuImage = document.getElementById('menuImage');
const menuName = document.getElementById('menuName');
const calDetail = document.getElementById('calDetail');
const proDetail = document.getElementById('proDetail');
const fatDetail = document.getElementById('fatDetail');
const carbDetail = document.getElementById('carbDetail');
const addMenuBtn = document.getElementById('addMenuBtn');

function prepare(circle){
  const r = parseFloat(circle.getAttribute('r'));
  const c = 2*Math.PI*r;
  circle.style.strokeDasharray = c;
  circle.style.strokeDashoffset = c;
  return c;
}
const calCirc = prepare(calProg);
const proCirc = prepare(proProg);
const fatCirc = prepare(fatProg);
const carbCirc = prepare(carbProg);

function setProgress(circle, circumference, fraction){
  fraction = Math.max(0, Math.min(1, fraction));
  circle.style.strokeDashoffset = circumference * (1 - fraction);
}

function updateUI(){
  calNum.textContent = `${totals.calories} kcal`;
  proNum.textContent = `${totals.protein} g`;
  fatNum.textContent = `${totals.fat} g`;
  carbNum.textContent = `${totals.carbs} g`;
  setProgress(calProg, calCirc, totals.calories/GOALS.calories);
  setProgress(proProg, proCirc, totals.protein/GOALS.protein);
  setProgress(fatProg, fatCirc, totals.fat/GOALS.fat);
  setProgress(carbProg, carbCirc, totals.carbs/GOALS.carbs);
}

resetBtn.addEventListener('click', ()=>{
  totals = { calories:0, protein:0, fat:0, carbs:0 };
  updateUI();
  searchInput.value = '';
  suggestions.innerHTML = '';
  suggestions.style.display = 'none';
  menuDetailBox.style.display = 'none';
});

// Search suggestions
searchInput.addEventListener('input', ()=>{
  const q = searchInput.value.trim().toLowerCase();
  suggestions.innerHTML = '';
  if(!q){ suggestions.style.display = 'none'; return; }
  const matched = menuData.filter(m => m.name.toLowerCase().includes(q));
  matched.forEach(item=>{
    const li = document.createElement('li');
    const regex = new RegExp(`(${q})`, 'gi');
    li.innerHTML = item.name.replace(regex, `<span class="match">$1</span>`);
    
    li.addEventListener('click', ()=>{
        menuDetailBox.style.display = 'flex';
        menuImage.src = item.imageURL;
        menuName.textContent = item.name;
        calDetail.textContent = item.nutrition.calories;
        proDetail.textContent = item.nutrition.protein;
        fatDetail.textContent = item.nutrition.fat;
        carbDetail.textContent = item.nutrition.carbs;
        
        suggestions.style.display = 'none';
        searchInput.value = '';
    });
    suggestions.appendChild(li);
  });
  suggestions.style.display = matched.length? 'block':'none';
});

addMenuBtn.addEventListener('click', () => {
    const selectedCalories = parseFloat(calDetail.textContent);
    const selectedProtein = parseFloat(proDetail.textContent);
    const selectedFat = parseFloat(fatDetail.textContent);
    const selectedCarbs = parseFloat(carbDetail.textContent);
    
    totals.calories += selectedCalories;
    totals.protein += selectedProtein;
    totals.fat += selectedFat;
    totals.carbs += selectedCarbs;
    
    updateUI();
    
    menuDetailBox.style.display = 'none';
});

document.addEventListener('click', e=>{ if(!e.target.closest('.search-box')) suggestions.style.display='none'; });

// BMI / BMR / TDEE
function calculateMetrics(weight, height, age, gender, activity, goalType){
  const h_m = height / 100;
  const bmi = weight / (h_m*h_m);
  let bmr = (10*weight)+(6.25*height)-(5*age)+(gender==='male'?5:-161);
  let tdee = Math.round(bmr*activity);
  let goalCalories = tdee;
  if(goalType==='lose') goalCalories = Math.round(tdee*0.8);
  else if(goalType==='gain') goalCalories = Math.round(tdee*1.2);
  return {bmi,bmr,tdee,goalCalories};
}

function showResults(bmi, bmr, tdee, goalCalories){
  let bmiStatus='';
  if(bmi<18.5) bmiStatus='น้ำหนักน้อย';
  else if(bmi<25) bmiStatus='น้ำหนักปกติ';
  else if(bmi<30) bmiStatus='น้ำหนักเกิน';
  else bmiStatus='อ้วน';

  bmrResult.innerHTML = `BMR: <span style="font-weight:700;">${bmr.toFixed(0)} kcal</span>, TDEE: <span style="font-weight:700;">${tdee} kcal</span>, เป้าหมาย: <span style="font-weight:700;">${goalCalories} kcal</span>`;
  bmiResult.innerHTML = `BMI: <span style="font-weight:700;">${bmi.toFixed(1)}</span> <span style="color:${bmiStatus==='น้ำหนักปกติ'?'green':(bmiStatus==='น้ำหนักน้อย'?'orange':'red')}; font-weight:700;">${bmiStatus}</span>`;
  localStorage.setItem('bmi', bmi.toFixed(1));
  localStorage.setItem('personal', JSON.stringify({bmr,tdee,goalCalories}));
  GOALS.calories = goalCalories;
}

window.addEventListener('load', ()=>{
    const savedBMI = localStorage.getItem('bmi');
    const savedPersonal = JSON.parse(localStorage.getItem('personal'));
    const savedInputs = JSON.parse(localStorage.getItem('inputs'));
    
    if(savedInputs){
        weightInput.value = savedInputs.weight;
        heightInput.value = savedInputs.height;
        ageInput.value = savedInputs.age;
        genderInput.value = savedInputs.gender;
        activityInput.value = savedInputs.activity;
        goalInput.value = savedInputs.goal;
    }
    
    if(savedBMI && savedPersonal){
        showResults(Number(savedBMI), savedPersonal.bmr, savedPersonal.tdee, savedPersonal.goalCalories);
    }
    
    updateUI();
});

calcBtn.addEventListener('click', ()=>{
  const w = parseFloat(weightInput.value);
  const h = parseFloat(heightInput.value);
  const a = parseFloat(ageInput.value);
  const g = genderInput.value;
  const act = parseFloat(activityInput.value);
  const goal = goalInput.value;
  
  if(w>0 && h>0 && a>0){
    const metrics = calculateMetrics(w,h,a,g,act,goal);
    showResults(metrics.bmi, metrics.bmr, metrics.tdee, metrics.goalCalories);
    
    const inputs = {weight:w, height:h, age:a, gender:g, activity:act, goal:goal};
    localStorage.setItem('inputs', JSON.stringify(inputs));
  } else alert('กรุณากรอกข้อมูลให้ครบและถูกต้อง');
});

updateUI();

</script>
</body>
</html>